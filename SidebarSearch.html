<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    Title: <input type="text" id="title-input" data-column-name="title" class="search-bar" autocomplete="off" placeholder="War And Peace">
    <br>
    Everything: <input type="text" id="everything-input" data-column-name="everything" class="search-bar" autocomplete="off" placeholder="Title, Author, etc.">
    <br>
    <input type="button" value="Search" id="search-submit">
    <hr>
    <input type="submit" value="Clear" id="clear-button"/>
    <input type="button" value="Close" id="close-button"/>
  </body>
  <script>
  (function() {
    const DOM = {};
    DOM.titleInput = document.querySelector("#title-input");
    DOM.searchSubmit = document.querySelector("#search-submit");

    DOM.searchBars =  document.querySelectorAll(".search-bar");

    DOM.clearButton = document.querySelector("#clear-button");
    DOM.closeButton = document.querySelector("#close-button");

    function submitSearch(e){
      e.preventDefault();
      const allColumns = ["isbn", "title", "description"]
      const searchPairs = {}
      // TODO: refactor all this
      DOM.searchBars.forEach(function(searchBar) {
        const searchTerm = searchBar.value.trim();
        if(searchTerm.length){
          let columnNames = [searchBar.dataset.columnName];
          if(columnNames[0] == "everything"){
            columnNames = allColumns
          }
          columnNames.forEach(function(columnName){
            if(searchPairs[columnName]){
              searchPairs[columnName].push(searchTerm)
            }
            else {
              searchPairs[columnName] = [searchTerm]
            }
          })
        }
      })
      alert(JSON.stringify(searchPairs))
      // google.script.run.sidebarSearch(searchGroups)
    }

    function clearSearch(){
      google.script.run.clearSearchFilter();
      DOM.searchBars.forEach(function(searchBar) {
        searchBar.value = "";
      })
    }

    function closeSidebar () {
      clearSearch();
      google.script.host.close();
    }

    DOM.searchBars.forEach(function(searchBar) {
      searchBar.addEventListener("keyup", function(e){
        if (e.keyCode === 13) {
          submitSearch(e);
        }
      });
    })

    DOM.searchSubmit.addEventListener("click", submitSearch);
    DOM.clearButton.addEventListener("click", clearSearch);
    DOM.closeButton.addEventListener("click", closeSidebar);
  })();
  </script>
</html>
